{"id":"oz-3em","title":"Self-review changes","description":"Review your own changes before running tests.\n\n**1. Review the diff:**\n```bash\ngit diff origin/main...HEAD     # All changes vs main\ngit log --oneline origin/main..HEAD  # All commits\n```\n\n**2. Check for common issues:**\n\n| Category | Look For |\n|----------|----------|\n| Bugs | Off-by-one, null handling, edge cases |\n| Security | Injection, auth bypass, exposed secrets |\n| Style | Naming, formatting, code organization |\n| Completeness | Missing error handling, incomplete paths |\n| Cruft | Debug prints, commented code, TODOs |\n\n**3. Fix issues found:**\nDon't just note them - fix them now. Amend or add commits as needed.\n\n**4. Verify no unintended changes:**\n```bash\ngit diff --stat origin/main...HEAD\n# Only files relevant to oz-kff should appear\n```\n\nIf you accidentally modified unrelated files, remove those changes.\n\n**Exit criteria:** Changes are clean, reviewed, and ready for testing.","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-24T16:01:51Z","updated_at":"2026-02-24T16:01:51Z","dependencies":[{"issue_id":"oz-3em","depends_on_id":"oz-nqm","type":"parent-child","created_at":"2026-02-24T16:01:50Z","created_by":"nasko","metadata":"{}"},{"issue_id":"oz-3em","depends_on_id":"oz-raa","type":"blocks","created_at":"2026-02-24T16:01:50Z","created_by":"nasko","metadata":"{}"}],"ephemeral":true,"work_type":"mutex"}
{"id":"oz-6yp","title":"Verify pre-flights pass on base branch","description":"Check if the codebase is healthy BEFORE starting your work.\n\n**The Scotty Principle:** Don't walk past a broken warp core. But also don't\nlet someone else's mess consume your entire mission.\n\n**1. Run pre-flights on main:**\n\nYour branch was just created from or rebased on `origin/main` with no\nimplementation changes yet — you're already at the base branch state.\n\nRun each configured check, then tests:\n\nIf typecheck_command is set: ``\nIf lint_command is set: ``\nIf test_command is set: `go test ./...`\n\n```bash\n       # Check for type errors (if command set)\n            # Check for lint errors (if command set)\ngo test ./...            # Run tests (if command set)\n```\n\nEmpty commands mean \"not configured\" — skip silently.\n\n**2. If pre-flights pass:**\n\nContinue to implement step.\n\n**3. If pre-flights fail on main:**\n\nFile a bead and proceed. Do NOT fix pre-existing failures yourself — that is\nnot your assignment. Your job is to fix the issue on your hook, not main.\n\n| Situation | Action |\n|-----------|--------|\n| Any pre-existing failure | File bead, proceed with your work |\n\nFORBIDDEN: Pushing to main. FORBIDDEN: Fixing pre-existing failures.\nYou work on YOUR feature branch only. `gt done` handles push/MR.\n\n**File and proceed path:**\n```bash\nbd create --title \"Pre-existing failure: \u003cdescription\u003e\" --type bug --priority 1\n\ngt mail send \u003crig\u003e/witness -s \"NOTICE: main has failing pre-flights\" -m \"Found pre-existing failures on main.\nFiled: \u003cbead-id\u003e\nProceeding with my assigned work (oz-kff).\"\n```\n\n**Context consideration:**\nIf investigating pre-existing failures consumed significant context:\n```bash\ngt handoff -s \"Investigated pre-existing failures, ready for assigned work\" -m \"Issue: oz-kff\nFound: \u003cwhat failed\u003e\nReady to start: implement step\"\n```\nFresh session continues from implement.\n\n**Exit criteria:** Pre-flights pass on main (or issue filed), ready to implement.","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-24T16:01:51Z","updated_at":"2026-02-24T16:01:51Z","dependencies":[{"issue_id":"oz-6yp","depends_on_id":"oz-a11","type":"blocks","created_at":"2026-02-24T16:01:50Z","created_by":"nasko","metadata":"{}"},{"issue_id":"oz-6yp","depends_on_id":"oz-nqm","type":"parent-child","created_at":"2026-02-24T16:01:50Z","created_by":"nasko","metadata":"{}"}],"ephemeral":true,"work_type":"mutex"}
{"id":"oz-8mh","title":"Commit all implementation changes","description":"Ensure ALL implementation work is committed before cleanup.\n\n**CRITICAL: You MUST commit all changes from implementation.**\nNEVER use `git checkout -- .` or `git restore .` to discard implementation work.\nALWAYS commit ALL uncommitted changes from your implementation.\n\n**1. Check for uncommitted changes:**\n```bash\ngit status\n```\n\n**2. If there are ANY uncommitted changes, commit them now:**\n```bash\ngit add -A \u0026\u0026 git commit -m \"\u003ctype\u003e: \u003cdescriptive message\u003e (oz-kff)\"\n```\n\n**3. If working tree is already clean, skip.**\n\n**4. VERIFY:**\n```bash\ngit status\n```\nMust show \"nothing to commit, working tree clean\".\n\n**5. Verify you have commits:**\n```bash\ngit log origin/main..HEAD --oneline\n```\nIf you made changes during implementation, this MUST show at least 1 commit.\n\n**Exit criteria:** All changes committed. Working tree clean.","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-24T16:01:51Z","updated_at":"2026-02-24T16:01:51Z","dependencies":[{"issue_id":"oz-8mh","depends_on_id":"oz-nqm","type":"parent-child","created_at":"2026-02-24T16:01:50Z","created_by":"nasko","metadata":"{}"},{"issue_id":"oz-8mh","depends_on_id":"oz-zi5","type":"blocks","created_at":"2026-02-24T16:01:50Z","created_by":"nasko","metadata":"{}"}],"ephemeral":true,"work_type":"mutex"}
{"id":"oz-a11","title":"Set up working branch","description":"Ensure you're on a clean feature branch ready for work.\n\n**1. Check current branch state:**\n```bash\ngit status\ngit branch --show-current\n```\n\n**2. If not on a feature branch, create one:**\n```bash\ngit fetch origin\ngit checkout -b polecat/\u003cname\u003e origin/main\n```\n\n**3. Ensure clean working state:**\n```bash\ngit status                  # Should show \"working tree clean\"\ngit stash list              # Should be empty\n```\n\nIf dirty state from previous work:\n```bash\n# If changes are relevant to this issue:\ngit add -A \u0026\u0026 git commit -m \"WIP: \u003cdescription\u003e\"\n\n# If changes are unrelated cruft:\ngit stash push -m \"unrelated changes before oz-kff\"\n# Or discard if truly garbage:\ngit checkout -- .\n```\n\n**4. Sync with main:**\n```bash\ngit fetch origin\ngit rebase origin/main      # Get latest, rebase your branch\n```\n\nIf rebase conflicts:\n- Resolve them carefully\n- Test after resolution\n- If stuck, mail Witness\n\n**5. Run project setup (if configured):**\n\nIf setup_command is set, run it to install dependencies:\n```bash\n\n```\n\nThis ensures dependencies are installed before pre-flight checks.\nEmpty setup_command means \"not configured\" — skip this step.\n\n**Exit criteria:** You're on a clean feature branch, rebased on latest main, dependencies installed.","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-24T16:01:51Z","updated_at":"2026-02-24T16:01:51Z","dependencies":[{"issue_id":"oz-a11","depends_on_id":"oz-glr","type":"blocks","created_at":"2026-02-24T16:01:50Z","created_by":"nasko","metadata":"{}"},{"issue_id":"oz-a11","depends_on_id":"oz-nqm","type":"parent-child","created_at":"2026-02-24T16:01:50Z","created_by":"nasko","metadata":"{}"}],"ephemeral":true,"work_type":"mutex"}
{"id":"oz-alo","title":"Clean up workspace","description":"Ensure workspace is pristine before handoff.\n\n**IMPORTANT: Do NOT run `git push`. That is `gt done`'s job (next step).**\n**IMPORTANT: Do NOT discard implementation changes. They must already be committed.**\n\n**1. Check for untracked files:**\n```bash\ngit status --porcelain\n```\nShould be empty. If not:\n- Add to .gitignore if appropriate\n- Remove if temporary: `rm \u003cfile\u003e`\n- Commit if needed: `git add \u003cfile\u003e \u0026\u0026 git commit -m \"chore: add \u003cfile\u003e\"`\n\n**2. Check stash:**\n```bash\ngit stash list\n```\nShould be empty. If not:\n- Pop and commit: `git stash pop \u0026\u0026 git add -A \u0026\u0026 git commit -m \"chore: unstash work (oz-kff)\"`\n- Or drop if truly garbage: `git stash drop`\n\n**3. Verify clean state and commits:**\n```bash\ngit status                  # Must show \"working tree clean\"\ngit stash list              # Must be empty\ngit log origin/main..HEAD   # Your commits (should show your work)\n```\n\nIf `git log origin/main..HEAD` shows nothing but you DID make changes,\nsomething went wrong. Do NOT proceed — mail Witness for help.\n\n**Exit criteria:** Workspace clean, no cruft, all work committed. Do NOT push — `gt done` handles that.","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-24T16:01:51Z","updated_at":"2026-02-24T16:01:51Z","dependencies":[{"issue_id":"oz-alo","depends_on_id":"oz-8mh","type":"blocks","created_at":"2026-02-24T16:01:50Z","created_by":"nasko","metadata":"{}"},{"issue_id":"oz-alo","depends_on_id":"oz-nqm","type":"parent-child","created_at":"2026-02-24T16:01:50Z","created_by":"nasko","metadata":"{}"}],"ephemeral":true,"work_type":"mutex"}
{"id":"oz-ao4","title":"Prepare work for review","description":"Verify work is complete and ready for merge queue.\n\n**Note:** Do NOT close the issue. The Refinery will close it after successful merge.\nThis enables conflict-resolution retries without reopening closed issues.\n\n**1. Verify the issue shows your work:**\n```bash\nbd show oz-kff\n# Status should still be 'in_progress' (you're working on it)\n```\n\n**2. Add completion notes:**\n```bash\nbd update oz-kff --notes \"Implemented: \u003cbrief summary of what was done\u003e\"\n```\n\n**3. Sync beads:**\n```bash\nbd sync\n```\n\n**Exit criteria:** Issue updated with completion notes, beads synced.","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-24T16:01:51Z","updated_at":"2026-02-24T16:01:51Z","dependencies":[{"issue_id":"oz-ao4","depends_on_id":"oz-alo","type":"blocks","created_at":"2026-02-24T16:01:50Z","created_by":"nasko","metadata":"{}"},{"issue_id":"oz-ao4","depends_on_id":"oz-nqm","type":"parent-child","created_at":"2026-02-24T16:01:50Z","created_by":"nasko","metadata":"{}"}],"ephemeral":true,"work_type":"mutex"}
{"id":"oz-glr","title":"Load context and verify assignment","description":"Initialize your session and understand your assignment.\n\n**1. Prime your environment:**\n```bash\ngt prime                    # Load role context\nbd prime                    # Load beads context\n```\n\n**2. Check your hook:**\n```bash\ngt hook               # Shows your pinned molecule and hook_bead\n```\n\nThe hook_bead is your assigned issue. Read it carefully:\n```bash\nbd show oz-kff           # Full issue details\n```\n\n**3. Check inbox for additional context:**\n```bash\ngt mail inbox\n# Read any HANDOFF or assignment messages\n```\n\n**4. Understand the requirements:**\n- What exactly needs to be done?\n- What files are likely involved?\n- Are there dependencies or blockers?\n- What does \"done\" look like?\n\n**5. Verify you can proceed:**\n- No unresolved blockers on the issue\n- You understand what to do\n- Required resources are available\n\nIf blocked or unclear, mail Witness immediately:\n```bash\ngt mail send \u003crig\u003e/witness -s \"HELP: Unclear requirements\" -m \"Issue: oz-kff\nQuestion: \u003cwhat you need clarified\u003e\"\n```\n\n**Exit criteria:** You understand the work and can begin implementation.","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-24T16:01:51Z","updated_at":"2026-02-24T16:01:51Z","dependencies":[{"issue_id":"oz-glr","depends_on_id":"oz-nqm","type":"parent-child","created_at":"2026-02-24T16:01:50Z","created_by":"nasko","metadata":"{}"}],"ephemeral":true,"work_type":"mutex"}
{"id":"oz-kff","title":"Find bugs in jira analytics and fix them","description":"attached_molecule: oz-nqm\nattached_at: 2026-02-24T16:01:52Z\ndispatched_by: unknown\n\n...","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-24T15:59:06Z","created_by":"nasko","updated_at":"2026-02-24T18:24:00Z","closed_at":"2026-02-24T18:24:00Z","close_reason":"Closed"}
{"id":"oz-l56","title":"Submit work and self-clean","description":"Submit your work and clean up. You cease to exist after this step.\n\n**Self-Cleaning Model:**\nOnce you run `gt done`, you're gone. The command:\n1. Pushes your branch to origin\n2. Creates an MR bead in the merge queue\n3. Nukes your sandbox (worktree removal)\n4. Exits your session immediately\n\n**Run gt done:**\n```bash\ngt done\n```\n\nYou should see output like:\n```\n✓ Work submitted to merge queue\n  MR ID: gt-xxxxx\n  Source: polecat/\u003cname\u003e\n  Target: main\n  Issue: oz-kff\n✓ Sandbox nuked\n✓ Session exiting\n```\n\n**What happens next (not your concern):**\n- Refinery processes your MR from the queue\n- Refinery rebases and merges to main\n- Refinery closes the issue\n- If conflicts: Refinery spawns a FRESH polecat to re-implement\n\nYou are NOT involved in any of that. You're gone. Done means gone.\n\n**Exit criteria:** Work submitted, sandbox nuked, session exited.","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-24T16:01:51Z","updated_at":"2026-02-24T16:01:51Z","dependencies":[{"issue_id":"oz-l56","depends_on_id":"oz-ao4","type":"blocks","created_at":"2026-02-24T16:01:50Z","created_by":"nasko","metadata":"{}"},{"issue_id":"oz-l56","depends_on_id":"oz-nqm","type":"parent-child","created_at":"2026-02-24T16:01:50Z","created_by":"nasko","metadata":"{}"}],"ephemeral":true,"work_type":"mutex"}
{"id":"oz-nqm","title":"mol-polecat-work","description":"Full polecat work lifecycle from assignment through completion.\n\nThis molecule guides a polecat through a complete work assignment. Each step\nhas clear entry/exit criteria and specific commands to run. A polecat can\ncrash after any step and resume from the last completed step.\n\n## Polecat Contract (Self-Cleaning Model)\n\nYou are a self-cleaning worker. You:\n1. Receive work via your hook (pinned molecule + issue)\n2. Work through molecule steps using `bd mol current` / `bd close \u003cstep\u003e`\n3. Complete and self-clean via `gt done` (submit + nuke yourself)\n4. You are GONE - Refinery merges from MQ\n\n**Self-cleaning:** When you run `gt done`, you push your work, submit to MQ,\nnuke your sandbox, and exit. There is no idle state. Done means gone.\n\n**Important:** This formula defines the template. Your molecule already has step\nbeads created from it. Use `gt hook` to find your pinned molecule, then `bd show`\nfor step details — do NOT read this file directly.\n\n**You do NOT:**\n- Push directly to main (Refinery merges from MQ)\n- Close your own issue (Refinery closes after merge)\n- Wait for merge (you're gone after `gt done`)\n- Handle rebase conflicts (Refinery spawns fresh polecats for that)\n\n## Variables\n\n| Variable | Source | Description |\n|----------|--------|-------------|\n| issue | hook_bead | The issue ID you're assigned to work on |\n| base_branch | sling vars | The base branch to rebase on (default: main) |\n| setup_command | rig config | Setup/install command (e.g., `pnpm install`). Empty = skip. |\n| typecheck_command | rig config | Type check command (e.g., `tsc --noEmit`). Empty = skip. |\n| test_command | rig config | Test command. Empty = skip. Rig must configure for its language. |\n| lint_command | rig config | Lint command (e.g., `eslint .`). Empty = skip. |\n| build_command | rig config | Build command (e.g., `go build ./...`). Empty = skip. |\n\n## Failure Modes\n\n| Situation | Action |\n|-----------|--------|\n| Tests fail | Fix them. Do not proceed with failures. |\n| Blocked on external | Mail Witness for help, mark yourself stuck |\n| Context filling | Use gt handoff to cycle to fresh session |\n| Unsure what to do | Mail Witness, don't guess |","status":"open","priority":2,"issue_type":"epic","created_at":"2026-02-24T16:01:51Z","updated_at":"2026-02-24T16:01:51Z","dependencies":[{"issue_id":"oz-nqm","depends_on_id":"oz-kff","type":"blocks","created_at":"2026-02-24T16:01:50Z","created_by":"nasko","metadata":"{}"}],"ephemeral":true,"work_type":"mutex"}
{"id":"oz-ozon-crew-nasko","title":"Crew worker nasko in ozon","description":"Crew worker nasko in ozon - human-managed persistent workspace.","status":"open","priority":2,"issue_type":"agent","owner":"you@example.com","created_at":"2026-02-24T17:58:41Z","created_by":"Your Name","updated_at":"2026-02-24T17:58:41Z","labels":["gt:agent"]}
{"id":"oz-ozon-polecat-obsidian","title":"oz-ozon-polecat-obsidian","description":"oz-ozon-polecat-obsidian\n\nrole_type: polecat\nrig: ozon\nagent_state: spawning\nhook_bead: oz-kff\ncleanup_status: null\nactive_mr: null\nnotification_level: null","status":"open","priority":2,"issue_type":"agent","owner":"you@example.com","created_at":"2026-02-24T18:11:30Z","created_by":"Your Name","updated_at":"2026-02-24T18:11:42Z","labels":["gt:agent"],"ephemeral":true,"hook_bead":"oz-kff"}
{"id":"oz-ozon-refinery","title":"Refinery for ozon","description":"Refinery for ozon - processes merge queue.","status":"open","priority":2,"issue_type":"agent","owner":"you@example.com","created_at":"2026-02-24T17:58:41Z","created_by":"Your Name","updated_at":"2026-02-24T17:58:41Z","labels":["gt:agent"]}
{"id":"oz-ozon-witness","title":"Witness for ozon","description":"Witness for ozon - monitors polecat health and progress.","status":"open","priority":2,"issue_type":"agent","owner":"you@example.com","created_at":"2026-02-24T17:58:40Z","created_by":"Your Name","updated_at":"2026-02-24T17:58:40Z","labels":["gt:agent"]}
{"id":"oz-raa","title":"Implement the solution","description":"Do the actual implementation work.\n\n**Working principles:**\n- Follow existing codebase conventions\n- Make atomic, focused commits\n- Keep changes scoped to the assigned issue\n- Don't gold-plate or scope-creep\n\n**Commit frequently:**\n```bash\n# After each logical unit of work:\ngit add \u003cfiles\u003e\ngit commit -m \"\u003ctype\u003e: \u003cdescription\u003e (oz-kff)\"\n```\n\nCommit types: feat, fix, refactor, test, docs, chore\n\n**Discovered work:**\nIf you find bugs or improvements outside your scope:\n```bash\nbd create --title \"Found: \u003cdescription\u003e\" --type bug --priority 2\n# Note the ID, continue with your work\n```\n\nDo NOT fix unrelated issues in this branch.\n\n**If stuck:**\nDon't spin for more than 15 minutes. Mail Witness:\n```bash\ngt mail send \u003crig\u003e/witness -s \"HELP: Stuck on implementation\" -m \"Issue: oz-kff\nTrying to: \u003cwhat you're attempting\u003e\nProblem: \u003cwhat's blocking you\u003e\nTried: \u003cwhat you've attempted\u003e\"\n```\n\n**Exit criteria:** Implementation complete, all changes committed.","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-24T16:01:51Z","updated_at":"2026-02-24T16:01:51Z","dependencies":[{"issue_id":"oz-raa","depends_on_id":"oz-6yp","type":"blocks","created_at":"2026-02-24T16:01:50Z","created_by":"nasko","metadata":"{}"},{"issue_id":"oz-raa","depends_on_id":"oz-nqm","type":"parent-child","created_at":"2026-02-24T16:01:50Z","created_by":"nasko","metadata":"{}"}],"ephemeral":true,"work_type":"mutex"}
{"id":"oz-rig-ozon","title":"ozon","description":"Rig identity bead for ozon.\n\nprefix: oz\nstate: active","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-24T15:36:42Z","created_by":"nasko","updated_at":"2026-02-24T15:36:42Z","labels":["gt:rig"]}
{"id":"oz-zi5","title":"Run quality checks and tests","description":"Verify your changes don't break anything and are properly tested.\n\n**1. Run quality checks (skip any that are not configured):**\n\nIf setup_command is set: ``\nIf typecheck_command is set: ``\nIf lint_command is set: ``\nIf build_command is set: ``\n\n```bash\n           # Make sure all newly added dependencies are installed (if command set)\n       # Check for type errors (if command set)\n            # Check for lint errors (if command set)\n            # Make sure it builds (if command set)\n```\n\nEmpty commands mean \"not configured for this project\" — skip silently.\n\n**2. If quality checks fail:**\n- Read the failure output carefully\n- Determine if your change caused it:\n  - If yes: Fix it. Return to implement step if needed.\n  - If no (pre-existing): File a bead, but still must pass for your PR\n\n```bash\n# Check if failure exists on main:\ngit stash\ngit checkout origin/main\n# Re-run the failing command(s)\ngit checkout -\ngit stash pop\n```\n\n**3. Run the full test suite:**\n```bash\ngo test ./...            # Run tests (configured per-rig)\n```\n\n**ALL TESTS MUST PASS.** Do not proceed with failures.\n\n**4. If tests fail:**\n- Read the failure output carefully\n- Determine if your change caused it:\n  - If yes: Fix it. Return to implement step if needed.\n  - If no (pre-existing): File a bead, but still must pass for your PR\n\n```bash\n# Check if failure exists on main:\ngit stash\ngit checkout origin/main\ngo test ./...\ngit checkout -\ngit stash pop\n```\n\n**5. Verify test coverage for new code:**\n- New features should have tests\n- Bug fixes should have regression tests\n- If you added significant code without tests, add them now\n\n**Exit criteria:** All quality checks and tests pass, new code has appropriate test coverage.","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-24T16:01:51Z","updated_at":"2026-02-24T16:01:51Z","dependencies":[{"issue_id":"oz-zi5","depends_on_id":"oz-3em","type":"blocks","created_at":"2026-02-24T16:01:50Z","created_by":"nasko","metadata":"{}"},{"issue_id":"oz-zi5","depends_on_id":"oz-nqm","type":"parent-child","created_at":"2026-02-24T16:01:50Z","created_by":"nasko","metadata":"{}"}],"ephemeral":true,"work_type":"mutex"}
{"id":"ozon-g0o","title":"Test task","description":"Check beads works","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-24T15:26:49Z","created_by":"nasko","updated_at":"2026-02-24T15:26:49Z"}
