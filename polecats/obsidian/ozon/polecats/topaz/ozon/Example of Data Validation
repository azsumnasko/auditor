import jsonschema

def validate_data(data, schema):
    try:
        jsonschema.validate(instance=data, schema=schema)
    except jsonschema.exceptions.ValidationError as e:
        print(f"Data validation error: {e}")
        sys.exit(1)

# Define the JSON schema for jira_analytics_latest.json
jira_schema = {
    "type": "object",
    "properties": {
        "projects": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "key": {"type": "string"},
                    "data": {"type": "object"}
                },
                "required": ["key", "data"]
            }
        }
    },
    "required": ["projects"]
}

def load_data(path=None):
    try:
        with open(path or "jira_analytics_latest.json", encoding="utf-8") as f:
            data = json.load(f)
            validate_data(data, jira_schema)
            return data
    except FileNotFoundError:
        print("Error: Data file not found.")
        sys.exit(1)
    except json.JSONDecodeError:
        print("Error: Invalid JSON format in data file.")
        sys.exit(1)

def main():
    try:
        data = load_data(sys.argv[1] if len(sys.argv) > 1 else None)
        
        def project_from_key(key):
            if not key or "-" not in key:
                return None
            return key.split("-", 1)[0]
        
        # Process and generate dashboard based on the loaded data
        pass
    
    except Exception as e:
        print(f"An error occurred: {e}")
        sys.exit(1)

if __name__ == '__main__':
    main()
